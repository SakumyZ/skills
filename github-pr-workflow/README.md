# GitHub PR 工作流自动化 Skill

完整自动化 GitHub PR 的创建、合并流程，支持用户交互、冲突检测和智能合并。

## 文件结构

```
github-pr-workflow/
├── SKILL.md                              # Skill 定义和工作流程说明
├── QUICKSTART.md                         # 快速开始指南
├── README.md                             # 本文件
└── scripts/
    └── Invoke-GitHubPRWorkflow.ps1       # 主工作流 PowerShell 脚本
```

## 功能清单

### ✅ 核心功能

- [x] 交互式获取 PR 标题和 commit message
- [x] 自动检测当前分支和目标分支
- [x] 基于当前分支创建 PR
- [x] 检查合并冲突
- [x] Squash 模式合并
- [x] 合并成功后自动删除分支

### ✅ 智能安装功能

- [x] 自动检测 GitHub CLI 安装
- [x] 未安装时提示多种安装方式供选择
- [x] 自动调用安装命令
- [x] 安装完成后提示重启 PowerShell

### ✅ 智能登录功能

- [x] 自动检测 GitHub 登录状态
- [x] 未登录时提示用户确认
- [x] 自动运行 `gh auth login`
- [x] 等待用户完成浏览器认证
- [x] 认证成功后继续执行工作流

### ✅ 错误处理

- [x] 检查 GitHub CLI 安装 - 自动提示安装
- [x] 检查 GitHub 登录状态 - 自动提示登录
- [x] 检查 git 仓库初始化
- [x] 检查分支是否推送到远程
- [x] 冲突检测和提示
- [x] 详细的错误信息提示

### ✅ 用户体验

- [x] 彩色输出（成功、错误、警告、信息）
- [x] 操作进度提示
- [x] 用户确认步骤
- [x] 选择菜单（用于选择安装方式）
- [x] 冲突时的解决指导
- [x] 清晰的命令行界面

## 使用场景

### 场景 1: 快速合并功能分支

```powershell
cd D:\Projects\Private\Housei\sk-gs\sk-gs-mgt-frontend
& "C:\Users\housei\.claude\skills\github-pr-workflow\scripts\Invoke-GitHubPRWorkflow.ps1"
```

1. 输入 PR 标题
2. 输入 commit message
3. 脚本自动创建 PR、检查冲突、合并

### 场景 2: 仅创建 PR 不自动合并

```powershell
& "C:\Users\housei\.claude\skills\github-pr-workflow\scripts\Invoke-GitHubPRWorkflow.ps1" -AutoMerge $false
```

### 场景 3: 处理有冲突的分支

脚本检测到冲突时会停止，并显示解决步骤

## 工作流程图

```
┌─────────────────────────────────┐
│  验证前置条件（gh、git、登录）    │
└────────────┬────────────────────┘
             ↓
┌─────────────────────────────────┐
│  获取分支信息（当前、目标）      │
└────────────┬────────────────────┘
             ↓
┌─────────────────────────────────┐
│  获取用户输入（标题、message）   │
└────────────┬────────────────────┘
             ↓
┌─────────────────────────────────┐
│  创建 PR                         │
└────────────┬────────────────────┘
             ↓
┌─────────────────────────────────┐
│  检查合并冲突                    │
└────────────┬────────┬───────────┘
             │        │
        无冲突│        │有冲突
             ↓        ↓
    ┌─────────────┐  ┌──────────────────┐
    │ 确认合并    │  │ 提示手动解决     │
    └──┬──────────┘  └──────────────────┘
       │
    用户确认
       │
       ↓
    ┌─────────────────────────────────┐
    │  Squash 合并 + 删除分支         │
    └────────────┬────────────────────┘
                 ↓
            ┌─────────────┐
            │  完成！     │
            └─────────────┘
```

## 主要参数

| 参数         | 类型   | 说明         | 默认值   |
| ------------ | ------ | ------------ | -------- |
| `AutoMerge`  | switch | 是否自动合并 | $true    |
| `BaseBranch` | string | 目标分支名称 | 自动检测 |

## 前置条件

✅ 必要：

- Windows 系统
- PowerShell 5.0+
- git 已安装
- 互联网连接（用于 GitHub 认证）

❌ 不需要：

- GitHub CLI 预先安装 - 脚本会自动检测并提示安装
- GitHub 预先登录 - 脚本会自动检测并提示登录
- GitHub Desktop
- 任何 IDE

## 安装步骤

### 1. 检查 Windows 版本

此脚本仅支持 Windows，使用 PowerShell

### 2. 首次运行脚本即可

脚本会自动：

- 检测 GitHub CLI 是否安装，如未安装会提示你选择安装方式
- 检测 GitHub 登录状态，如未登录会自动打开登录流程

## 输出示例

```
╔════════════════════════════════════════╗
║  GitHub PR 自动化工作流               ║
╚════════════════════════════════════════╝

ℹ️  检查前置条件...
✅ 前置条件检查通过
ℹ️  获取分支信息...
✅ 当前分支: feature/login-fix
✅ 目标分支: main
ℹ️  请输入 PR 信息
PR 标题: 修复登录页面样式问题
Commit Message (按 Enter 后输入，输入 'END' 后回车结束):
- 修复按钮颜色
- 调整边距
END

ℹ️  PR 信息确认:
  标题: 修复登录页面样式问题
  Message: - 修复按钮颜色
          - 调整边距

是否继续? (y/n): y

ℹ️  创建 PR...
✅ PR 创建成功
https://github.com/user/repo/pull/123

ℹ️  检查合并冲突...
✅ 无合并冲突，可以合并

是否立即合并 PR #123? (y/n): y

ℹ️  合并 PR (squash 模式)...
✅ PR 合并成功
✅ Deleted branch feature/login-fix (was abcdef1).

✅ 工作流完成！
ℹ️  PR 已成功创建并合并
```

## 常见问题

**Q: 脚本支持 Mac/Linux 吗？**
A: 当前仅支持 Windows。可以根据需要修改为 Bash 版本。

**Q: 如果没有安装 GitHub CLI 怎么办？**
A: 脚本会自动检测并提示你选择安装方式：

- 使用 winget（推荐，自动安装）
- 使用 Scoop
- 手动下载

选择后脚本会自动完成安装，或打开下载页面。

**Q: 如果没有登录 GitHub 怎么办？**
A: 脚本会自动检测并提示你登录。确认后脚本会自动运行 `gh auth login`，等待你在浏览器完成认证。

**Q: 如果有冲突怎么办？**
A: 脚本会停止合并，并提供详细的解决步骤。解决后可重新运行脚本。

**Q: 能否改为强制合并？**
A: 不建议。脚本设计上优先确保分支可安全合并。可根据需要手动修改脚本。

**Q: 合并模式能改吗？**
A: 可以。脚本使用 `--squash` 模式，可以修改为 `--merge` 或 `--rebase`。

## 许可证

本 skill 遵循项目许可证

## 贡献

欢迎提交 issue 或改进建议
