# Excel 格式转换参考

## 目录
- [概览](#概览)
- [转换规则](#转换规则)
- [合并单元格处理](#合并单元格处理)
- [样式语义提取](#样式语义提取)
- [特殊字符处理](#特殊字符处理)
- [工作表处理](#工作表处理)
- [格式限制](#格式限制)

## 概览

本文档详细说明 Excel → Markdown 转换的规则。

## 转换规则

### 空值处理
- Excel 空单元格 → Markdown 空字符串
- 示例：`| 数据A |  | 数据C |`

### 换行符处理
- `\n`、`\r\n`、`\r` → `<br>`
- 示例：`第一行<br>第二行`

### 数据类型转换
- 所有值统一转为字符串
- 数字 `123` → `"123"`，日期 `2024-01-01` → `"2024-01-01"`，布尔 `TRUE` → `"True"`

### 表格格式
- 第一行作为表头
- 表头后自动生成分隔行 `| --- | --- |`
- 所有数据行列数与表头对齐

## 合并单元格处理

### 规则
- 合并区域内的所有单元格都填充左上角的值
- 行合并和列合并均支持

### 示例

Excel 中：
```
| A（合并2列） |     | B |
| C            | D   | E |
```

转换结果：
```markdown
| col1 | col2 | col3 |
| --- | --- | --- |
| A | A | B |
| C | D | E |
```

## 样式语义提取

使用 `--styles` 参数开启，样式标注附在表格下方的折叠区块中。

### 支持的样式

| 样式 | Markdown 效果 | 标注格式 |
| --- | --- | --- |
| 粗体 | `**文本**`（直接应用） | `bold` |
| 删除线 | `~~文本~~`（直接应用） | `strikethrough` |
| 背景色 | 无（仅标注） | `bg:yellow`、`bg:#FF0000` |

### 常见背景色语义

在式样书中，背景色通常有业务含义：

| 颜色 | 常见含义 |
| --- | --- |
| 黄色 (yellow) | 必须项、需注意 |
| 红色 (red) | 警告、禁止 |
| 绿色 (green/light-green) | 完成、通过 |
| 蓝色 (light-blue) | 信息、参考 |
| 灰色 (gray) | 不可编辑、固定值 |
| 橙色 (orange/light-orange) | 待确认、变更 |

### 标注输出格式

```markdown
<details><summary>样式标注</summary>

- [1,1]: bold, bg:yellow
- [2,3]: bg:light-green

</details>
```

## 特殊字符处理

### 竖线转义
- `|` → `\|`，避免破坏表格结构

### 其他字符
- `*`、`_`、`#` 等不做转义（保留 Markdown 语义能力）

## 工作表处理

### 多工作表
- 每个工作表独立一个二级标题 `## SheetName`
- 文件级标题为一级标题 `# 文件名`

### 空工作表
- 显示 `*该工作表为空*`

### 大文件优化
- 列数 > 50 或行数 > 10000 时，自动计算实际有数据的范围
- 跳过尾部大量空白行和列

## 格式限制

### 不保留的格式
- 字体颜色（除粗体/删除线外的字体样式）
- 单元格边框样式
- 公式（仅显示计算结果）
- 图片/图表嵌入对象
- 条件格式

### 支持的文件格式
- `.xlsx` - Excel 2007+
- `.xls` - Excel 97-2003
- `.xlsm` - 启用宏的 Excel 工作簿
